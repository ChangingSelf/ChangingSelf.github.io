<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="python爬虫学习笔记2模拟登录与数据库, 憧憬少的个人博客">
    <meta name="description" content="为了加入学校里面一个技术小组，我接受了写一个爬取学校网站通知公告的任务。这个任务比以前写的爬虫更难的地方在于，需要模拟登录才能获得页面，以及将得到的数据存入数据库。
本文按照日期来记录我完成任务的过程，然后再整理一遍全部代码。读者可以通过侧">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>python爬虫学习笔记2模拟登录与数据库 | 憧憬少的个人博客</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <script src="/libs/jquery/jquery.min.js"></script>
    
<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="憧憬少的个人博客" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>


<body>

    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"/>
    <script src="https://ChangingSelf.github.io/live2d-widget/autoload.js"></script>




    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper head-container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">憧憬少的个人博客</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">憧憬少的个人博客</div>
        <div class="logo-desc">
            
            Never really desperate, only the lost of the soul.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			Contact
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>

        </div>

        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/3.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">python爬虫学习笔记2模拟登录与数据库</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        height: calc(100vh - 250px);
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/python/">
                                <span class="chip bg-color">python</span>
                            </a>
                        
                            <a href="/tags/spider/">
                                <span class="chip bg-color">spider</span>
                            </a>
                        
                            <a href="/tags/mysql/">
                                <span class="chip bg-color">mysql</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E8%BF%87%E7%A8%8B%E5%A4%8D%E7%9B%98/" class="post-category">
                                过程复盘
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2019-03-09
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2020-04-06
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    7.5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-clock fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    30 分
                </div>
                
				
                
            </div>
            
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <p>为了加入学校里面一个技术小组，我接受了写一个爬取学校网站通知公告的任务。这个任务比以前写的爬虫更难的地方在于，需要模拟登录才能获得页面，以及将得到的数据存入数据库。</p>
<p>本文按照日期来记录我完成任务的过程，然后再整理一遍全部代码。读者可以通过侧栏目录跳转阅读。不介绍库的安装。</p>
<p>传送门：<a href="https://hanechiri.github.io/post/python_spider_note1simple_spider/#more" target="_blank" rel="noopener">爬虫学习笔记1</a></p>
<a id="more"></a>

<h1 id="转载声明"><a href="#转载声明" class="headerlink" title="转载声明"></a>转载声明</h1><p><strong>关于参考链接：</strong>本文用到的其他博客的链接都以（我自己对内容的概括或者文章原标题-来源网站-作者名）的格式给出，关于作者名，只有博客作者自己明确声明为“原创”，我才会加上作者名。引用的文章内容我会放在来源链接的下方。</p>
<p><strong>关于本文：</strong>我发一下链接都注明出处了，如果想转载，也请这样做。作者<strong>憧憬少</strong>，链接的话看浏览器地址栏。</p>
<h1 id="任务介绍"><a href="#任务介绍" class="headerlink" title="任务介绍"></a>任务介绍</h1><p>爬取信息门户新闻并且存入数据库。</p>
<p>首先分解任务：</p>
<ol>
<li>实现爬取综合新闻页面的公开新闻存入markdown文件中(190303完成)</li>
<li>将数据存到数据库（190304完成）</li>
<li>学习模拟登录（190305到190307完成）</li>
<li>爬取信息门户新闻（190308完成）</li>
<li>（进阶）将代码进行封装、优化（目前未封装）</li>
<li>（进阶）动态更新（目前未着手）</li>
</ol>
<h1 id="过程记录"><a href="#过程记录" class="headerlink" title="过程记录"></a>过程记录</h1><h2 id="190303-周日"><a href="#190303-周日" class="headerlink" title="190303 周日"></a>190303 周日</h2><h3 id="练习爬取公开页面"><a href="#练习爬取公开页面" class="headerlink" title="练习爬取公开页面"></a>练习爬取公开页面</h3><p>我的<a href="https://hanechiri.github.io/post/python_spider_note1simple_spider/#more" target="_blank" rel="noopener">第一个爬虫</a>是在2月多的时候在家写的，那个只是个简单的爬虫，目标是公开的页面，不需要模拟登录，也不需要存储到数据库，直接存到txt文件中。</p>
<p>先爬取学校官网的综合新闻页面复习一下。</p>
<p>首先讲一下我的思路：</p>
<p>由于新闻和公告页面通常是有一个目录页面的，也就是包含子页面的链接，在目录的子页面内才是正文内容。</p>
<p>假设这一页目录有三个新闻，就像是下面：</p>
<ul>
<li>新闻目录<ul>
<li>新闻一</li>
<li>新闻二</li>
<li>新闻三</li>
<li>点击查看下一页</li>
</ul>
</li>
</ul>
<p>这样的结构。</p>
<p>如果要写一个爬虫函数来爬取所有新闻页面，那么就要从目录着手。目录中含有前往别的新闻页面的链接，所以可以在目录页获取本页所有新闻的链接，遍历所有链接并提取新闻内容。</p>
<p>至于翻页也可以这样做到，“下一页”按钮也是一个链接，可以通过这个链接获取到下一页的内容。翻页部分原理比较简单，我是先攻克其他难关，把它留到最后写的。</p>
<h4 id="提取单页面新闻"><a href="#提取单页面新闻" class="headerlink" title="提取单页面新闻"></a>提取单页面新闻</h4><p>首先是提取单个页面的新闻。向目标url发出访问请求：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">def</span> <span class="token function">getNews</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    提取页面的新闻与图片并存储为markdown文件
    :param url: 要爬取的目标网页url
    :return: 无
    '''</span>
    <span class="token comment" spellcheck="true">#发送请求</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#r为response对象</span>
    html<span class="token operator">=</span>r<span class="token punctuation">.</span>text<span class="token comment" spellcheck="true">#r.text是请求的网页的内容</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="编码问题"><a href="#编码问题" class="headerlink" title="编码问题"></a>编码问题</h5><p>这里遇到了第一个问题，提取到的页面有乱码。</p>
<p>解决方法：先获取响应对象的二进制响应内容，然后将其编码为utf8</p>
<p><strong>参考链接：</strong></p>
<ul>
<li><a href="https://blog.csdn.net/t8116189520/article/details/78930009" target="_blank" rel="noopener">python中response.text与response.content的区别-CSDN</a></li>
</ul>
<blockquote>
<p>requests.content返回的是二进制响应内容</p>
<p>而requests.text则是根据网页的响应来猜测编码</p>
</blockquote>
<ul>
<li><a href="https://www.cnblogs.com/gavin-num1/p/5170247.html" target="_blank" rel="noopener">UNICODE,GBK,UTF-8区别（一个比较好的编码的教程，便于理解编码的概念）-博客园</a></li>
<li><a href="https://blog.csdn.net/w_linux/article/details/78370218" target="_blank" rel="noopener">Python解决抓取内容乱码问题（decode和encode解码）-CSDN-浅然_</a></li>
</ul>
<blockquote>
<p>字符串在Python内部的表示是unicode编码，在做编码转换时，通常需要以unicode作为中间编码，即先将其他编码的字符串解码（decode）成unicode，再从unicode编码（encode）成另一种编码。</p>
<p>decode的作用是将其他编码的字符串转换成unicode编码，如str1.decode(‘gb2312’)，表示将gb2312编码的字符串str1转换成unicode编码。</p>
<p>encode的作用是将unicode编码转换成其他编码的字符串，如str2.encode(‘utf-8’)，表示将unicode编码的字符串str2转换成utf-8编码。</p>
</blockquote>
<p>修改代码为：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#发送请求</span>
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
html<span class="token operator">=</span>r<span class="token punctuation">.</span>content<span class="token comment" spellcheck="true">#获取二进制字节流</span>
html<span class="token operator">=</span>html<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#转换为utf8编码（该网页使用的是utf8编码）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="解析网页（bs4）"><a href="#解析网页（bs4）" class="headerlink" title="解析网页（bs4）"></a>解析网页（bs4）</h5><p>一开始我和之前一样使用正则表达式来提取，但是不够熟悉，总是写不出匹配的上的正则表达式。还是使用另一个东西——BeautifulSoup库</p>
<p>具体如何使用请查看其他教程，本文只说我自己用到的部分。</p>
<p><strong>参考链接：</strong></p>
<ul>
<li><p><a href="https://blog.csdn.net/qq_42331423/article/details/80796683" target="_blank" rel="noopener">Python爬虫常用的几种数据提取方式-CSDN-凯里潇</a></p>
</li>
<li><p><a href="https://www.bilibili.com/video/av18202461?p=11" target="_blank" rel="noopener">零基础入门python3爬虫-bilibili</a>（里面的视频p11）</p>
</li>
<li><p><a href="https://blog.csdn.net/qq_41686130/article/details/79856474" target="_blank" rel="noopener">beautifulsoup（基本选择器，标准选择器，css选择器）-CSDN-Halosec_Wei</a>（基本上是上面一个b站链接的文字版，不知道是不是同一个人）</p>
</li>
<li><p><a href="https://www.jb51.net/article/65287.htm" target="_blank" rel="noopener">beautifulsoup详细教程-脚本之家</a></p>
</li>
<li><p><a href="https://blog.csdn.net/kikaylee/article/details/56841789" target="_blank" rel="noopener">beautifulsoup基本用法总结-CSDN-kikay</a></p>
</li>
</ul>
<blockquote>
<p>BeautifulSoup是Python的一个库，最主要的功能就是从网页爬取我们需要的数据。BeautifulSoup将html解析为对象进行处理，全部页面转变为字典或者数组，相对于正则表达式的方式，可以大大简化处理过程。</p>
</blockquote>
<p>我目前的理解是，这个BeautifulSoup库需要用到其他html解析库，可以使用python自带的，也可以安装第三方库，其他的库就像功能扩展插件一样，没有的话它自己也能解析。我安装了名为lxml的解析库。</p>
<p>查看源代码，找到网页中有关新闻的代码，手动将其格式化之后如下（内容不重要，省略）：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>arti-title<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>标题省略<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>arti-metas<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>arti-update<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>发布时间：2019-01-23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>arti-update1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>作者：xx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>arti-update2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>来源：xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>entry<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>article</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>read<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>wp_articlecontent<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>新闻前言省略
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>新闻内容省略
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>556<span class="token punctuation">"</span></span> <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>320<span class="token punctuation">"</span></span> <span class="token attr-name">align</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bottom<span class="token punctuation">"</span></span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>url省略<span class="token punctuation">"</span></span> <span class="token attr-name">border</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">text-align</span><span class="token punctuation">:</span>right<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>（审稿：xx <span class="token entity" title="&nbsp;">&amp;nbsp;</span>网络编辑：xx）
             <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
         <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>article</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接着上面的代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#解析html</span>
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">"lxml"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#返回已解析的对象</span>

<span class="token comment" spellcheck="true">#获取标题</span>
title<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'arti-title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>string
<span class="token comment" spellcheck="true">#获取时间</span>
update<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'arti-update'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>string
<span class="token comment" spellcheck="true">#获取正文标签</span>
content<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'wp_articlecontent'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="提取图片"><a href="#提取图片" class="headerlink" title="提取图片"></a>提取图片</h5><p>我打算将新闻保存到markdown文件中，提取新闻中的图片的链接的地址，这样在md文件中就能显示出图片了。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#获取图片链接</span>
base<span class="token operator">=</span><span class="token string">'学校官网url，用于和img标签中的相对地址拼接成绝对地址'</span>
imgsTag<span class="token operator">=</span>content<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
imgsUrl<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> img <span class="token keyword">in</span> imgsTag<span class="token punctuation">:</span>
    imgsUrl<span class="token punctuation">.</span>append<span class="token punctuation">(</span>base<span class="token operator">+</span>img<span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#拼接成完整的url</span>
    img<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#删除图片标签</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="删除多余标签"><a href="#删除多余标签" class="headerlink" title="删除多余标签"></a>删除多余标签</h5><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#删除多余标签</span>
<span class="token keyword">for</span> p <span class="token keyword">in</span> content<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'style'</span><span class="token punctuation">:</span><span class="token string">"text-align:center;"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
p<span class="token operator">=</span>content<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'style'</span><span class="token punctuation">:</span> <span class="token string">"text-align:right;"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">!=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
    p<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="保存到文件"><a href="#保存到文件" class="headerlink" title="保存到文件"></a>保存到文件</h5><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># 拼接成字符串</span>
<span class="token comment" spellcheck="true">#后来知道这样的提取方式其实不能完全提取到所有内容</span>
fileContent<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> content<span class="token punctuation">.</span>contents<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#遍历正文内容的所有子标签</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>string<span class="token operator">!=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#如果子标签里面有内容</span>
        <span class="token comment" spellcheck="true">#print(i.string)#调试</span>
        fileContent<span class="token operator">+=</span>i<span class="token punctuation">.</span>string<span class="token comment" spellcheck="true">#基本只剩下p标签了</span>
        fileContent<span class="token operator">+=</span><span class="token string">'\n\n'</span>

<span class="token comment" spellcheck="true">#保存到md文件</span>
<span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'data.md'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fout<span class="token punctuation">:</span>
    fout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>fileContent<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h5 id="代码总览"><a href="#代码总览" class="headerlink" title="代码总览"></a>代码总览</h5><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup<span class="token comment" spellcheck="true">#第4个版本改名bs4而不是全名那么长了</span>
<span class="token keyword">def</span> <span class="token function">getNews</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    提取页面的新闻与图片并存储为markdown文件
    :param url: 要爬取的目标网页url
    :return: 无
    '''</span>
    <span class="token comment" spellcheck="true">#发出请求</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
    html<span class="token operator">=</span>r<span class="token punctuation">.</span>content
    html<span class="token operator">=</span>html<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#转换编码</span>
    <span class="token comment" spellcheck="true">#解析html</span>
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">"lxml"</span><span class="token punctuation">)</span>
    content<span class="token operator">=</span>soup<span class="token punctuation">.</span>article

    <span class="token comment" spellcheck="true">#获取标题</span>
    title<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'arti-title'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>string
    <span class="token comment" spellcheck="true">#获取时间</span>
    update<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'arti-update'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>string
    <span class="token comment" spellcheck="true">#获取正文</span>
    content<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'wp_articlecontent'</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#获取图片链接</span>
    base<span class="token operator">=</span><span class="token string">'http://xxxxx.xxx'</span><span class="token comment" spellcheck="true">#学校官网url，用于和img标签中的相对地址拼接成绝对地址</span>
    imgsTag<span class="token operator">=</span>content<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">)</span>
    imgsUrl<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> img <span class="token keyword">in</span> imgsTag<span class="token punctuation">:</span>
        imgsUrl<span class="token punctuation">.</span>append<span class="token punctuation">(</span>base<span class="token operator">+</span>img<span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#拼接成完整的url</span>
        img<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#删除图片标签</span>
    <span class="token comment" spellcheck="true">#删除多余标签</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> content<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'style'</span><span class="token punctuation">:</span><span class="token string">"text-align:center;"</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        p<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
    p<span class="token operator">=</span>content<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'style'</span><span class="token punctuation">:</span> <span class="token string">"text-align:right;"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>p<span class="token operator">!=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
        p<span class="token punctuation">.</span>extract<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true"># 拼接成字符串</span>
    fileContent<span class="token operator">=</span><span class="token string">''</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> content<span class="token punctuation">.</span>contents<span class="token punctuation">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>string<span class="token operator">!=</span>None<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true">#print(i.string)#调试</span>
            fileContent<span class="token operator">+=</span>i<span class="token punctuation">.</span>string
            fileContent<span class="token operator">+=</span><span class="token string">'\n\n'</span>


    <span class="token keyword">with</span> open<span class="token punctuation">(</span><span class="token string">'data.md'</span><span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fout<span class="token punctuation">:</span>
        fout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>fileContent<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="提取多页面新闻"><a href="#提取多页面新闻" class="headerlink" title="提取多页面新闻"></a>提取多页面新闻</h4><p>原理在上面说了，提取完单页基本上就完成了。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">def</span> <span class="token function">getNewsContents</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    爬取目录页面链接到的页面
    :param url: 新闻目录页面的url
    :return: 无
    '''</span>
    <span class="token comment" spellcheck="true">#获取网页内容</span>
    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#以get方式访问</span>
    html<span class="token operator">=</span>r<span class="token punctuation">.</span>content
    html<span class="token operator">=</span>html<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#获取每篇新闻的链接</span>
    base<span class="token operator">=</span><span class="token string">'http://xxxxx.xxx'</span><span class="token comment" spellcheck="true">#学校官网url，用于和相对地址拼接成绝对地址</span>
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> page_url <span class="token keyword">in</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'column-news-item'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        page_url<span class="token operator">=</span>base<span class="token operator">+</span><span class="token string">'/'</span><span class="token operator">+</span>page_url<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>page_url<span class="token punctuation">)</span>
        getNews<span class="token punctuation">(</span>page_url<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#调用提取单页函数</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="day1进度"><a href="#day1进度" class="headerlink" title="day1进度"></a>day1进度</h3><ol>
<li>实现爬取长安大学综合新闻页面的公开新闻存入markdown文件中</li>
<li>复习了requests库的使用</li>
<li>学习了BeautifulSoup4库的基本使用</li>
</ol>
<h2 id="190304-周一"><a href="#190304-周一" class="headerlink" title="190304 周一"></a>190304 周一</h2><p>这一天主要是将前一天爬取的数据存入数据库。</p>
<h3 id="将数据存入数据库"><a href="#将数据存入数据库" class="headerlink" title="将数据存入数据库"></a>将数据存入数据库</h3><h4 id="安装MySQL数据库"><a href="#安装MySQL数据库" class="headerlink" title="安装MySQL数据库"></a>安装MySQL数据库</h4><p>参考链接：</p>
<ul>
<li><a href="https://www.bilibili.com/video/av18202461/?p=4" target="_blank" rel="noopener">零基础入门python3爬虫-bilibili</a>（里面的视频p4）</li>
</ul>
<h4 id="使用MySQL-Workbench"><a href="#使用MySQL-Workbench" class="headerlink" title="使用MySQL Workbench"></a>使用MySQL Workbench</h4><p>MySQL Workbench是一个可视化工具，安装MySQL的时候自带（我安装的是最新版的），在安装目录找到它的exe然后加个快捷方式在桌面，可以方便地查看数据和执行SQL查询指令，具体使用方法可以问度娘。我现在也不是很会。</p>
<p>我创建的数据库名为news，里面创建了一个数据表chdnews。</p>
<h4 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h4><p>和大多数数据库一样，MySQL是C/S模式的，也就是客户端（client）/服务端（server）模式的。数据库有可能在远程服务器上。想要使用数据库，就需要连接到数据库。</p>
<p>python中要使用数据库需要一个pymysql库。</p>
<p>下面是连接的代码：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> pymysql
<span class="token comment" spellcheck="true">#连接数据库</span>
db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> passwd<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token string">'news'</span><span class="token punctuation">,</span> charset<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>这个连接函数看参数名就可以看出含义了。</p>
<ul>
<li>host：主机ip，127.0.0.1是回传地址，指本机。也就是连接本电脑的MySQL的意思</li>
<li>port：端口号，用来和ip一起指定需要使用数据库的软件。在安装的时候会让你设置，默认3306</li>
<li>user&amp;passwd：用户名和密码，在安装的时候已经设置好了</li>
<li>db：你要连接的数据库的名字。一台电脑上可以有很多数据库，数据库里面可以有很多数据表。</li>
<li>charset：字符编码</li>
</ul>
<h4 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h4><p>接着可以准备一个游标，游标大概是一个用于存储结果集开头地址的指针吧，我是这么理解的。在我学了更多数据库知识后可能会更新这一部分。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#创建游标</span>
cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>接着执行SQL的插入语句：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#插入</span>
cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"insert into chdnews(`title`,`article`) values('{0}','{1}')"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>title<span class="token punctuation">,</span>fileContent<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#此处变量为上文代码中的变量</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>这里的SQL语句是这样的：</p>
<pre class="line-numbers language-SQL"><code class="language-SQL">insert into 数据表名(字段名1，字段名2) values(值1，值2)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>后面的<code>format</code>函数是python的格式化函数，将变量的值加入到字符串中对应位置。</p>
<p>最后提交：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#提交更改</span>
db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>接着打开workbench，就会发现已经存入数据库了。（你得把代码放在上面提取单页新闻的函数那里，放在保存到文件的那部分代码那儿）</p>
<h3 id="day2进度"><a href="#day2进度" class="headerlink" title="day2进度"></a>day2进度</h3><ol>
<li>下载并安装MySQL以及MySQL Workbench</li>
<li>使用pymysql库进行数据库的连接，实现了把第一天得到的数据存入数据库</li>
</ol>
<h2 id="190305-周二"><a href="#190305-周二" class="headerlink" title="190305 周二"></a>190305 周二</h2><h3 id="初步了解模拟登录"><a href="#初步了解模拟登录" class="headerlink" title="初步了解模拟登录"></a>初步了解模拟登录</h3><p>最后的任务需要爬取登录后才能查看的页面，于是我去搜索了很多博客，只放一部分对我有帮助的链接。</p>
<p>参考链接：</p>
<ul>
<li><p><a href="https://www.cnblogs.com/woainifanfan/p/5754580.html" target="_blank" rel="noopener">模拟登录CSDN-博客园</a></p>
</li>
<li><p><a href="https://www.cnblogs.com/wodeboke-y/p/9873609.html" target="_blank" rel="noopener">模拟登录github-博客园</a></p>
</li>
</ul>
<p>首先查看一下需要的登录数据：</p>
<ol>
<li>打开登录网页，用F12打开开发者工具，选择network（网络）选项卡</li>
<li>登录你的账号，此时控制台会显示一大堆请求与响应，找到以post方式发送的请求，一般排在第一个</li>
<li>那里会显示几个栏目，找到<code>Form Data</code>（表单数据），这个里面是你填写登录表单之后使用POST方式发送给服务端的内容。这里面除了自己填写的账号密码之外还有一些东西，比如下图的<code>lt</code>,<code>dllt</code>,<code>execution</code>,<code>_eventId</code>,<code>rmShown</code>这些都是在表单的隐藏域中，查看登录页面的源代码是可以看的到的。这些隐藏起来的东西是为了检验你是否是从浏览器进来的，只要获取到这些东西，再加上头部信息，就能伪装成浏览器了</li>
<li>至于头部信息，在下图也可以看到我折叠起来的几个栏目，有一个是<code>Request Headers</code>，这是我们在点击登录按钮时发送的POST请求信息的信息头。将里面的<code>User-Agent</code>给复制到你代码里面存在一个字典里面等会用</li>
<li>把头部信息和表单数据都看一下，准备一下</li>
</ol>
<p><img src="https://raw.githubusercontent.com/HaneChiri/PicBed/master/blog_images/spider_f12_form_data.png" alt=""></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#登录前的准备</span>
login_url <span class="token operator">=</span> <span class="token string">'http://xxxx.xxx'</span><span class="token comment" spellcheck="true">#登录页面的url</span>
<span class="token comment" spellcheck="true">#头部信息</span>
headers<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36'</span>
    <span class="token comment" spellcheck="true">#加上后面这些会后悔的，别加。</span>
    <span class="token string">'Host'</span><span class="token punctuation">:</span><span class="token string">'xx.xx.xx.xx'</span><span class="token punctuation">,</span>
    <span class="token string">'Referer'</span><span class="token punctuation">:</span><span class="token string">'http://xxx.xxx?xxx=http://xxx.xx'</span><span class="token punctuation">,</span>
    <span class="token string">'Origin'</span><span class="token punctuation">:</span><span class="token string">'http://xxx.xxx.xx'</span>
<span class="token punctuation">}</span>
<span class="token comment" spellcheck="true">#登录用的数据</span>
login_data<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'你的账号'</span><span class="token punctuation">,</span>
        <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'你的密码'</span><span class="token punctuation">,</span>
        <span class="token string">'btn'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'lt'</span><span class="token punctuation">:</span> LT<span class="token number">-790162</span><span class="token operator">-</span>J9kW2aEFsK3ihu4AzXcovdsJy6cYBM1552123884047<span class="token operator">-</span>D1Nx<span class="token operator">-</span>cas，
    <span class="token comment" spellcheck="true">#实际上lt并不能这样写上去，下文会解释。这里记录我自己的错误</span>
        <span class="token string">'dllt'</span><span class="token punctuation">:</span> <span class="token string">'userNamePasswordLogin'</span><span class="token punctuation">,</span>
        <span class="token string">'execution'</span><span class="token punctuation">:</span> <span class="token string">'e1s1'</span><span class="token punctuation">,</span>
        <span class="token string">'_eventId'</span><span class="token punctuation">:</span> <span class="token string">'submit'</span><span class="token punctuation">,</span>
        <span class="token string">'rmShown'</span><span class="token punctuation">:</span> <span class="token number">1</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>数据准备好之后就开始登录，使用的是requests的另一个方法——post。</p>
<p>向服务器发出请求（request）的方式有get和post，查看html源代码的时候在表单标签处可以看到表单提交的方法。如：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>casLoginForm<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>像这样写html代码会让浏览器在你按下登录按钮的时候以post的方式提交表单，也就是以post的方式向服务器发起request，将form data发送过去。</p>
<p>post方法的好处是在发送过程中会隐藏你的表单数据，不会被直接看到；</p>
<p>而前面使用过的get方法，会把你的表单数据加在url后面，网址后边以问号开头，以&amp;连接的就是发送过去的参数。</p>
<p>涉及登录用post比较好，以免轻易泄露密码。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#以post方式发出登录请求</span>
r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>login_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>login_data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>按理来说应该可以了呀，为什么不行？仍然得到登录页面。在这一天我折腾了很久，没有得到答案。</p>
<p>不过在找资料时却学到了其他的一些知识，关于cookie和session。</p>
<h3 id="cookie和session"><a href="#cookie和session" class="headerlink" title="cookie和session"></a>cookie和session</h3><p>我目前的理解（如果不对欢迎留言）：</p>
<p>http是无状态协议，两次访问都是独立的，不会保存状态信息。也就是你来过一次，下次再来的时候网站还是当你第一次来。那么怎么知道你来过，从而给你还原之前的数据呢？就有人想出cookie和session两种方式。</p>
<p><strong>cookie</strong>（直译：小甜饼）是服务端（网站服务器）收到客户端（你电脑）的request（请求）的时候和response（响应）一起发给客户端的数据。客户端把它存在文件里面，并在下一次访问这个网站时将cookie随着request一起发送过去，这样服务端就会知道你就是之前来过的那个人了。cookie存储在客户端。</p>
<ol>
<li>客户端发送request</li>
<li>服务端发送response附带一个cookie（一串数据）</li>
<li>客户端第二次访问时把cookie复制一份一起发过去</li>
<li>服务端看到你的cookie就知道你是谁了</li>
</ol>
<p><strong>session</strong>（会话）是在服务端内存中保存的一个数据结构，一旦有客户端来访问，那么就给这个客户端创建一个新的session在服务端的内存，并将它的session ID随着response发回给客户端。客户端第二次访问时，会将被分配的SID随着request一起发过来，服务端在这边验证SID之后就会知道你来过。session存储在服务端。</p>
<ol>
<li>客户端发送request</li>
<li>服务端发送response并在自己这边创建一个session（一堆数据）并发送一个session ID给客户端</li>
<li>客户端第二次访问时把session ID一起发过去</li>
<li>服务端看到你的session ID就知道你是谁了</li>
</ol>
<p>不过这俩是用来保持登录的，我还没登录成功想这个干啥？请看下一天。</p>
<h3 id="day3进度"><a href="#day3进度" class="headerlink" title="day3进度"></a>day3进度</h3><ol>
<li>初步了解cookie和session的概念</li>
<li>了解如何使用chrome浏览器的控制台查看post表单信息</li>
<li>尝试使用requests的post方法模拟登录，失败，返回登录页面</li>
</ol>
<h2 id="190306-周三"><a href="#190306-周三" class="headerlink" title="190306 周三"></a>190306 周三</h2><h3 id="表单校验码（非验证码）"><a href="#表单校验码（非验证码）" class="headerlink" title="表单校验码（非验证码）"></a>表单校验码（非验证码）</h3><p>怎么弄都不成功，都跳回登录页面。我只好去询问组长这是为什么。</p>
<p>原来我没发现表单校验码会变的！</p>
<p>一直没注意啊啊啊啊啊啊！</p>
<p>我没有认真比对过两次打开的乱码不一样，看结尾一样就以为一样了。其中的<code>lt</code>这个域每次打开网页都是不一样的，随机出的！</p>
<p>既然知道了问题，就好解决了。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#获取登录校验码</span>
html<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>login_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>
lt<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'lt'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
dllt<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'dllt'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
execution <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'execution'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
_eventId <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'_eventId'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
rmShown <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'rmShown'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
login_data<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'username'</span><span class="token punctuation">:</span> input<span class="token punctuation">(</span><span class="token string">"请输入学号："</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'password'</span><span class="token punctuation">:</span> input<span class="token punctuation">(</span><span class="token string">"请输入密码："</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token string">'btn'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token string">'lt'</span><span class="token punctuation">:</span> lt<span class="token punctuation">,</span>
    <span class="token string">'dllt'</span><span class="token punctuation">:</span> dllt<span class="token punctuation">,</span>
    <span class="token string">'execution'</span><span class="token punctuation">:</span> execution<span class="token punctuation">,</span>
    <span class="token string">'_eventId'</span><span class="token punctuation">:</span> _eventId<span class="token punctuation">,</span>
    <span class="token string">'rmShown'</span><span class="token punctuation">:</span> rmShown
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>为了保险，我把其他的表单域也给解析赋值给变量了。</p>
<p>不过仍然无法登陆成功，而是进入了一个诡异的页面:</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>Welcome to nginx!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style language-css">
    <span class="token selector">body </span><span class="token punctuation">{</span>
        <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">35</span>em<span class="token punctuation">;</span>
        <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span> auto<span class="token punctuation">;</span>
        <span class="token property">font-family</span><span class="token punctuation">:</span> Tahoma, Verdana, Arial, sans-serif<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>Welcome to nginx!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>For online documentation and support please refer to
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://nginx.org/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>nginx.org<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
Commercial support is available at
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://nginx.com/<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>nginx.com<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>em</span><span class="token punctuation">></span></span>Thank you for using nginx.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>em</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>确实有进展，但是这是啥？nginx？查了一下是一个高性能的HTTP和反向代理服务器，但是和我现在登录有什么关系呢？（黑人问号.jpg）</p>
<h3 id="利用session保持校验码"><a href="#利用session保持校验码" class="headerlink" title="利用session保持校验码"></a>利用session保持校验码</h3><p>即使登录成功，还有一个问题无法解决，那就是我获取校验码的request和登录用的request是两次不同的访问请求呀，这样校验码又会变化。</p>
<p>我想起了前一天看到的session，这玩意不就能让服务端记住我？（cookie试了一下，保存下来的是空的文件不知道怎么回事）</p>
<p>于是新建一个会话：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#新建会话</span>
session<span class="token operator">=</span>requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>在获取校验码的时候改成使用session变量来发起请求：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#获取登录校验码</span>
html<span class="token operator">=</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>login_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>这里的session是在客户端创建的，并不是服务端那个，我想它可能存储的是服务端发送过来的session ID吧。</strong></p>
<p>同理在正式发送请求时这样：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#登录</span>
r<span class="token operator">=</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>login_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>login_data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>这样就能让服务端知道我是刚刚获取校验码的那个小伙汁：D</p>
<p>在这一天我没有办法验证是否有效，不过在之后我验证了这个方法的成功性。</p>
<h3 id="day4进度"><a href="#day4进度" class="headerlink" title="day4进度"></a>day4进度</h3><ol>
<li>知道了原来有个每次会变化的校验码“lt”，找到了跳转回登录页面的原因。使用Beautifulsoup来获取每次的校验码，不过仍然没有解决无法登录的问题</li>
<li>使用session对象来保证获取校验码和登录时是同一个会话，未验证</li>
</ol>
<h2 id="190307-周四"><a href="#190307-周四" class="headerlink" title="190307 周四"></a>190307 周四</h2><h3 id="多余的头部信息"><a href="#多余的头部信息" class="headerlink" title="多余的头部信息"></a>多余的头部信息</h3><p>我终于发现了问题所在！！！！！</p>
<pre class="line-numbers language-python"><code class="language-python">headers<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36'</span><span class="token punctuation">,</span>
    <span class="token comment" spellcheck="true">#'Host':'xxx.xxx.xxx.xxx',</span>
    <span class="token comment" spellcheck="true">#'Referer':'http://xxx.xxx.xxx.xxx...',#不详细打码了</span>
    <span class="token comment" spellcheck="true">#'Origin':'http://xxx.xxx.xxxx'</span>
    <span class="token comment" spellcheck="true">#去掉多余的头信息才成功登录！！！！！卡了很久没想到是因为这个</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>头部信息写多了，我只保留了<code>User-Agent</code>之后成功登录了，你们能体会到我当时有多开心吗！</p>
<p>我将成为<del>新世界的卡密</del>小组里面最快完成的人！</p>
<p>解决了这个问题，剩下的就特别简单了。</p>
<p>当时我有一个下午的时间，于是我将进度迅速推进。</p>
<h3 id="爬取通知公告"><a href="#爬取通知公告" class="headerlink" title="爬取通知公告"></a>爬取通知公告</h3><p>设登录页面为pageA，登录之后的页面跳转到pageB，而pageB有一个按钮跳转到pageC，这个pageC就是day1的时候的目录页面，里面有着pageC1、pageC2、pageC3……等页面的链接，而这个pageC最后面还有个按钮用于跳转到目录的下一页，也就是pageC?pageIndex=2，还有137页公告栏目录。</p>
<p>没有什么新的东西，和day1说的爬取方式差不多，只是页面正文的格式和day1的新闻不太一样。核心结构如下，我省略了很多：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bulletin-content<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bulletin-contentpe65<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token punctuation">;</span><span class="token property">background</span><span class="token punctuation">:</span> white</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>_GoBack<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">font-size</span><span class="token punctuation">:</span> <span class="token number">20</span>px<span class="token punctuation">;</span><span class="token property">font-family</span><span class="token punctuation">:</span> 仿宋</span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
     校属各单位：
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>大概就是一个<code>&lt;p&gt;</code>标签里面放一个或多个<code>&lt;span&gt;</code>标签，而这里面可能还会嵌套几个<code>&lt;span&gt;</code>标签，里面才有内容，而两个内部的<code>&lt;span&gt;</code>之间还可能有内容。</p>
<p>这要怎么解析？</p>
<p>在尝试了很多方案之后，我终于百度到一个函数：</p>
<pre class="line-numbers language-python"><code class="language-python">tag<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#提取名为tag的bs4标签的内部的所有文字</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>参考链接：</p>
<ul>
<li><p><a href="https://blog.csdn.net/ScapeD/article/details/81913923" target="_blank" rel="noopener">BeautifulSoup获取标签中包含的文字-CSDN-niewzh</a>（正是这个博客解决了我的问题）</p>
</li>
<li><p><a href="https://blog.csdn.net/f156207495/article/details/78074240/" target="_blank" rel="noopener">BeautifulSoup中的.text方法和get_text()方法的区别-CSDN</a></p>
</li>
</ul>
<p>解决方案：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#获取正文内容</span>
html<span class="token operator">=</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>

article<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span>class_<span class="token operator">=</span><span class="token string">'bulletin-content'</span><span class="token punctuation">)</span>
news_content<span class="token operator">=</span><span class="token string">''</span>
<span class="token keyword">for</span> p <span class="token keyword">in</span> article<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> p<span class="token punctuation">.</span>span<span class="token operator">!=</span>None<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#如果p含有一层span</span>
        text<span class="token operator">=</span>str<span class="token punctuation">(</span>p<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#获取内容并去除多余空格</span>
        news_content<span class="token operator">+=</span>text<span class="token operator">+</span><span class="token string">'\n'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>接着我就把爬下来的东西存到数据库里面去了。弄完之后得去赶作业了，这一天的时间用完了。</p>
<h3 id="day5进度"><a href="#day5进度" class="headerlink" title="day5进度"></a>day5进度</h3><p>1.找到无法登录且跳转到未知页面的原因是头部信息加了多余的值，解决之后成功登录到信息门户，实现模拟登陆<br>2.利用之前爬取单个页面到文件的方法，用beautifulsoup解析并保存内容到文件<br>3.存入MySQL数据库中<br>4.还差爬取多页目录的功能，预计明天完成。整理代码后可提交</p>
<h2 id="190308-周五"><a href="#190308-周五" class="headerlink" title="190308 周五"></a>190308 周五</h2><h3 id="更多的目录页"><a href="#更多的目录页" class="headerlink" title="更多的目录页"></a>更多的目录页</h3><p>开了一个新文件准备整理一下代码，并完成最后一个功能——爬取完目录页第一页之后爬取后面更多的页。</p>
<p>查看源代码的时候，找“第二页”这个按钮对应的链接，发现了规律：</p>
<pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pagination-info clearFix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>共2740条记录 分137页显示<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>
        2740/137
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>detach.portal?pageIndex<span class="token punctuation">=</span>1&amp;amp;pageSize<span class="token punctuation">=</span>&amp;amp;.pmn<span class="token punctuation">=</span>view&amp;amp;.ia<span class="token punctuation">=</span>false&amp;amp;action<span class="token punctuation">=</span>bulletinsMoreView&amp;amp;search<span class="token punctuation">=</span>true&amp;amp;groupid<span class="token punctuation">=</span>all&amp;amp;.pen<span class="token punctuation">=</span>pe65<span class="token punctuation">'</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>点击跳转到第1页<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token entity" title="&lt;">&amp;lt;</span><span class="token entity" title="&lt;">&amp;lt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>当前页<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>        
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>detach.portal?pageIndex<span class="token punctuation">=</span>2&amp;amp;pageSize<span class="token punctuation">=</span>&amp;amp;.pmn<span class="token punctuation">=</span>view&amp;amp;.ia<span class="token punctuation">=</span>false&amp;amp;action<span class="token punctuation">=</span>bulletinsMoreView&amp;amp;search<span class="token punctuation">=</span>true&amp;amp;groupid<span class="token punctuation">=</span>all&amp;amp;.pen<span class="token punctuation">=</span>pe65<span class="token punctuation">'</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>点击跳转到第2页<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>            
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>detach.portal?pageIndex<span class="token punctuation">=</span>3&amp;amp;pageSize<span class="token punctuation">=</span>&amp;amp;.pmn<span class="token punctuation">=</span>view&amp;amp;.ia<span class="token punctuation">=</span>false&amp;amp;action<span class="token punctuation">=</span>bulletinsMoreView&amp;amp;search<span class="token punctuation">=</span>true&amp;amp;groupid<span class="token punctuation">=</span>all&amp;amp;.pen<span class="token punctuation">=</span>pe65<span class="token punctuation">'</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>点击跳转到第3页<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>detach.portal?pageIndex<span class="token punctuation">=</span>4&amp;amp;pageSize<span class="token punctuation">=</span>&amp;amp;.pmn<span class="token punctuation">=</span>view&amp;amp;.ia<span class="token punctuation">=</span>false&amp;amp;action<span class="token punctuation">=</span>bulletinsMoreView&amp;amp;search<span class="token punctuation">=</span>true&amp;amp;groupid<span class="token punctuation">=</span>all&amp;amp;.pen<span class="token punctuation">=</span>pe65<span class="token punctuation">'</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>点击跳转到第4页<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>4<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>detach.portal?pageIndex<span class="token punctuation">=</span>5&amp;amp;pageSize<span class="token punctuation">=</span>&amp;amp;.pmn<span class="token punctuation">=</span>view&amp;amp;.ia<span class="token punctuation">=</span>false&amp;amp;action<span class="token punctuation">=</span>bulletinsMoreView&amp;amp;search<span class="token punctuation">=</span>true&amp;amp;groupid<span class="token punctuation">=</span>all&amp;amp;.pen<span class="token punctuation">=</span>pe65<span class="token punctuation">'</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>点击跳转到第5页<span class="token punctuation">'</span></span><span class="token punctuation">></span></span>5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>detach.portal?pageIndex<span class="token punctuation">=</span>6&amp;amp;pageSize<span class="token punctuation">=</span>&amp;amp;.pmn<span class="token punctuation">=</span>view&amp;amp;.ia<span class="token punctuation">=</span>false&amp;amp;action<span class="token punctuation">=</span>bulletinsMoreView&amp;amp;search<span class="token punctuation">=</span>true&amp;amp;groupid<span class="token punctuation">=</span>all&amp;amp;.pen<span class="token punctuation">=</span>pe65<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token entity" title="&gt;">&amp;gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>detach.portal?pageIndex<span class="token punctuation">=</span>137&amp;amp;pageSize<span class="token punctuation">=</span>&amp;amp;.pmn<span class="token punctuation">=</span>view&amp;amp;.ia<span class="token punctuation">=</span>false&amp;amp;action<span class="token punctuation">=</span>bulletinsMoreView&amp;amp;search<span class="token punctuation">=</span>true&amp;amp;groupid<span class="token punctuation">=</span>all&amp;amp;.pen<span class="token punctuation">=</span>pe65<span class="token punctuation">'</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>点击跳转到最后页<span class="token punctuation">'</span></span><span class="token punctuation">></span></span><span class="token entity" title="&gt;">&amp;gt;</span><span class="token entity" title="&gt;">&amp;gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可以看出，指向其他目录页的相对链接，只是参数略有不同，参数中只有<code>pageIndex</code>发生了变化。至于给url加参数，我记得前几天看到过。</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#作为参数的字典</span>
para<span class="token operator">=</span><span class="token punctuation">{</span>
    <span class="token string">'pageIndex'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">#这里需要修改，先爬第一页</span>
    <span class="token string">'pageSize'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token string">'.pmn'</span><span class="token punctuation">:</span><span class="token string">'view'</span><span class="token punctuation">,</span>
    <span class="token string">'.ia'</span><span class="token punctuation">:</span><span class="token string">'false'</span><span class="token punctuation">,</span>
    <span class="token string">'action'</span><span class="token punctuation">:</span><span class="token string">'bulletinsMoreView'</span><span class="token punctuation">,</span>
    <span class="token string">'search'</span><span class="token punctuation">:</span><span class="token string">'true'</span><span class="token punctuation">,</span>
    <span class="token string">'groupid'</span><span class="token punctuation">:</span><span class="token string">'all'</span><span class="token punctuation">,</span>
    <span class="token string">'.pen'</span><span class="token punctuation">:</span><span class="token string">'pe65'</span>
<span class="token punctuation">}</span>
catalogue_url<span class="token operator">=</span><span class="token string">'http://xxx.xx.xx.cn/detach.portal'</span><span class="token comment" spellcheck="true">#未加参数的新闻目录页url</span>
    session <span class="token operator">=</span> login<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取已登录的session,这个自定义函数会在下面列出</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>page_count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#page_count是要获取的页数</span>
        para<span class="token punctuation">[</span><span class="token string">'pageIndex'</span><span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token comment" spellcheck="true">#设置新闻当前页的索引</span>

        <span class="token comment" spellcheck="true"># 从目录页获取新闻页面链接</span>
        html <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>catalogue_url<span class="token punctuation">,</span>params<span class="token operator">=</span>para<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="整理代码"><a href="#整理代码" class="headerlink" title="整理代码"></a>整理代码</h3><p>要用到的库</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> re
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup
<span class="token keyword">import</span> pymysql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="get-bulletin"><a href="#get-bulletin" class="headerlink" title="get_bulletin"></a>get_bulletin</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">get_bulletin</span><span class="token punctuation">(</span>page_count<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    目录有多页，从第一页开始获取，往后获取page_count页的目录，并读取目录指向的所有公告
    :param page_count: 要爬取的目录页面的数量
    :return: 无
    '''</span>
    para<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'pageIndex'</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        <span class="token string">'pageSize'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'.pmn'</span><span class="token punctuation">:</span><span class="token string">'view'</span><span class="token punctuation">,</span>
        <span class="token string">'.ia'</span><span class="token punctuation">:</span><span class="token string">'false'</span><span class="token punctuation">,</span>
        <span class="token string">'action'</span><span class="token punctuation">:</span><span class="token string">'bulletinsMoreView'</span><span class="token punctuation">,</span>
        <span class="token string">'search'</span><span class="token punctuation">:</span><span class="token string">'true'</span><span class="token punctuation">,</span>
        <span class="token string">'groupid'</span><span class="token punctuation">:</span><span class="token string">'all'</span><span class="token punctuation">,</span>
        <span class="token string">'.pen'</span><span class="token punctuation">:</span><span class="token string">'pe65'</span>
    <span class="token punctuation">}</span>
    catalogue_url<span class="token operator">=</span><span class="token string">'http://xxx.xxx.xxx.cn/detach.portal'</span><span class="token comment" spellcheck="true">#未加参数的公告目录页url</span>
    session <span class="token operator">=</span> login<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 获取已登录的session</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>page_count<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        para<span class="token punctuation">[</span><span class="token string">'pageIndex'</span><span class="token punctuation">]</span><span class="token operator">=</span>i<span class="token comment" spellcheck="true">#设置公告当前页的索引</span>

        <span class="token comment" spellcheck="true"># 从目录页获取公告页面链接</span>
        html <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>catalogue_url<span class="token punctuation">,</span>params<span class="token operator">=</span>para<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">'lxml'</span><span class="token punctuation">)</span>
        rss_title <span class="token operator">=</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'rss-title'</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#将得到的链接与标题组装成字典</span>
        bulletin_dict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
        <span class="token keyword">for</span> url <span class="token keyword">in</span> rss_title<span class="token punctuation">:</span>
            bulletin_title <span class="token operator">=</span> str<span class="token punctuation">(</span>url<span class="token punctuation">.</span>span<span class="token punctuation">.</span>string<span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            bulletin_url <span class="token operator">=</span> <span class="token string">'http://xxx.xx.xx.cn/'</span> <span class="token operator">+</span> url<span class="token punctuation">[</span><span class="token string">'href'</span><span class="token punctuation">]</span>
            bulletin_dict<span class="token punctuation">.</span>setdefault<span class="token punctuation">(</span>bulletin_title<span class="token punctuation">,</span> bulletin_url<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#添加一条公告记录</span>

        <span class="token comment" spellcheck="true">#保存公告到数据库</span>
        <span class="token keyword">for</span> bulletin_title<span class="token punctuation">,</span> bulletin_url <span class="token keyword">in</span> bulletin_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment" spellcheck="true">#saveInTXT(bulletin_url, session, bulletin_title)#这个是保存到txt文件的函数，用于测试</span>
            saveInDB<span class="token punctuation">(</span>news_url<span class="token punctuation">,</span> session<span class="token punctuation">,</span> news_title<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="login"><a href="#login" class="headerlink" title="login"></a>login</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    登录并返回已经登录的会话
    :return: 已经登录的会话（session）
    """</span>
    <span class="token comment" spellcheck="true">#设置</span>
    login_url <span class="token operator">=</span> <span class="token string">'http://xxx.xx.xx.cn/authserver/login?service=http%3A%2F%2F%2F'</span>
    headers<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span><span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36'</span>
    <span class="token punctuation">}</span>
    <span class="token comment" spellcheck="true">#新建会话</span>
    session<span class="token operator">=</span>requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">#获取登录校验码</span>
    html<span class="token operator">=</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>login_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>
    lt<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'lt'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
    dllt<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span><span class="token string">'dllt'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
    execution <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'execution'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
    _eventId <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'_eventId'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
    rmShown <span class="token operator">=</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'rmShown'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span>
    login_data<span class="token operator">=</span><span class="token punctuation">{</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> input<span class="token punctuation">(</span><span class="token string">"请输入学号："</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'password'</span><span class="token punctuation">:</span> input<span class="token punctuation">(</span><span class="token string">"请输入密码："</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">'btn'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token string">'lt'</span><span class="token punctuation">:</span> lt<span class="token punctuation">,</span>
        <span class="token string">'dllt'</span><span class="token punctuation">:</span> dllt<span class="token punctuation">,</span>
        <span class="token string">'execution'</span><span class="token punctuation">:</span> execution<span class="token punctuation">,</span>
        <span class="token string">'_eventId'</span><span class="token punctuation">:</span> _eventId<span class="token punctuation">,</span>
        <span class="token string">'rmShown'</span><span class="token punctuation">:</span> rmShown
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">#登录</span>
    response<span class="token operator">=</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>login_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>login_data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> response<span class="token punctuation">.</span>url<span class="token operator">==</span><span class="token string">'http://xxx.xx.xx.cn/'</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'登录成功！'</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> session<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="saveInTXT"><a href="#saveInTXT" class="headerlink" title="saveInTXT"></a>saveInTXT</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">saveInTXT</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> session<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    获取单个公告页面的公告并保存到txt
    :param url: 要获取的页面的url
    :param session:已经登录的会话
    :param title:公告标题
    :return:无
    '''</span>

    <span class="token comment" spellcheck="true">#将标题转换为可以作为文件名字的形式</span>
    reg <span class="token operator">=</span> r<span class="token string">'[\/:*?"&lt;>|]'</span>
    title <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span>reg<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> title<span class="token punctuation">)</span>

    path<span class="token operator">=</span><span class="token string">'bullet\\'</span> <span class="token operator">+</span> title<span class="token operator">+</span><span class="token string">'.txt'</span><span class="token comment" spellcheck="true">#保存在py文件目录下的bulletin文件夹内，以txt格式保存</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36'</span>
    <span class="token punctuation">}</span>
    <span class="token triple-quoted-string string">'''
    #测试代码，从文件读取手动获取的公告html页面，单机测试
    with open('new.txt','r',encoding='utf8') as fin:
        html=fin.read()
    '''</span>
    html<span class="token operator">=</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>
    <span class="token comment" spellcheck="true">#print(soup.prettify())</span>
    bulletin_content<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'bulletin-content'</span><span class="token punctuation">)</span>

    bulletin_content<span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> bulletin_content<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> p<span class="token punctuation">.</span>span<span class="token operator">!=</span>None<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#如果p含有一层span</span>
            text<span class="token operator">=</span>str<span class="token punctuation">(</span>p<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            bulletin_content<span class="token operator">+=</span> text <span class="token operator">+</span> <span class="token string">'\n'</span>

    <span class="token keyword">with</span> open<span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token string">'w'</span><span class="token punctuation">,</span>encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> fout<span class="token punctuation">:</span>
        fout<span class="token punctuation">.</span>write<span class="token punctuation">(</span>bulletin_content<span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'“{}”成功保存到{}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>title<span class="token punctuation">,</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="saveInDB"><a href="#saveInDB" class="headerlink" title="saveInDB"></a>saveInDB</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">saveInDB</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> session<span class="token punctuation">,</span> title<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    获取单个公告页面的公告并保存到txt
    :param url: 要获取的页面的url
    :param session:已经登录的会话
    :param title:公告标题
    :return:无
    '''</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.119 Safari/537.36'</span>
    <span class="token punctuation">}</span>

    html<span class="token operator">=</span>session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
    soup<span class="token operator">=</span>BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span><span class="token string">'lxml'</span><span class="token punctuation">)</span>
    bulletin_content<span class="token operator">=</span>soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">'bulletin-content'</span><span class="token punctuation">)</span>

    bulletin_content<span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> bulletin_content<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> p<span class="token punctuation">.</span>span<span class="token operator">!=</span>None<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#如果p含有一层span</span>
            text<span class="token operator">=</span>str<span class="token punctuation">(</span>p<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
            bulletin_content<span class="token operator">+=</span> text <span class="token operator">+</span> <span class="token string">'\n'</span>

    <span class="token comment" spellcheck="true">#保存到数据库</span>
    db <span class="token operator">=</span> pymysql<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">3306</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> passwd<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token string">'news'</span><span class="token punctuation">,</span> charset<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>
    cursor <span class="token operator">=</span> db<span class="token punctuation">.</span>cursor<span class="token punctuation">(</span><span class="token punctuation">)</span>
    cursor<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token string">"insert into chdnews(`title`,`content`) values('{0}','{1}')"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>title<span class="token punctuation">,</span> bulletin_content<span class="token punctuation">)</span><span class="token punctuation">)</span>
    db<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'已经成功保存公告到数据库：“{}”'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="调用"><a href="#调用" class="headerlink" title="调用"></a>调用</h4><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#调用</span>
get_bulletin<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#爬取10页公告</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>暂时没有将其通用化，直接将网址写死在函数里面了。</p>
<h3 id="day6进度"><a href="#day6进度" class="headerlink" title="day6进度"></a>day6进度</h3><ol>
<li>通过调整服务门户的url中的参数来获取通知公告的每一个目录页的url，从而爬取所有公告</li>
<li>将学习中写的测试代码重新构造整理，添加函数注释，提交任务</li>
</ol>
<h2 id="190309-周六"><a href="#190309-周六" class="headerlink" title="190309 周六"></a>190309 周六</h2><h3 id="day7进度"><a href="#day7进度" class="headerlink" title="day7进度"></a>day7进度</h3><p>写了本篇博客进行总结</p>

            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://yxChangingSelf.xyz" rel="external nofollow noreferrer">憧憬少</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://yxChangingSelf.xyz/posts/python_spider_note2login_and_database/">https://yxChangingSelf.xyz/posts/python_spider_note2login_and_database/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY-NC 4.0</a>
                    许可协议。转载请注明来源
                    <a href="https://yxChangingSelf.xyz" target="_blank">憧憬少</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/python/">
                                    <span class="chip bg-color">python</span>
                                </a>
                            
                                <a href="/tags/spider/">
                                    <span class="chip bg-color">spider</span>
                                </a>
                            
                                <a href="/tags/mysql/">
                                    <span class="chip bg-color">mysql</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
        </div>
    </div>

    
        <link rel="stylesheet" href="/libs/gitalk/gitalk.css">
<link rel="stylesheet" href="/css/my-gitalk.css">

<div class="card gitalk-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="gitalk-container" class="card-content"></div>
</div>

<script src="/libs/gitalk/gitalk.min.js"></script>
<script>
    let gitalk = new Gitalk({
        clientID: '2c2d9b5607027ef5684f',
        clientSecret: 'b974e75a7b4f1d80dee5e2ada5abad43526a05fc',
        repo: 'blog-comments',
        owner: 'ChangingSelf',
        admin: "ChangingSelf",
        id: '2019-03-09T13-30-43',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');
</script>
    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/posts/python_spider_note3class_spider/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/3.jpg" class="responsive-img" alt="python爬虫学习笔记3封装爬虫类">
                        
                        <span class="card-title">python爬虫学习笔记3封装爬虫类</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            在完成了基本的爬取任务之后，接到了将其封装为一个爬虫类的任务
传送门：

python爬虫学习笔记1一个简单的爬虫

python爬虫学习笔记2模拟登录与数据库




前言转载注明出处。
任务介绍1、尝试不使用session去进行爬取，最
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2019-03-15
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%BF%87%E7%A8%8B%E5%A4%8D%E7%9B%98/" class="post-category">
                                    过程复盘
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/python/">
                        <span class="chip bg-color">python</span>
                    </a>
                    
                    <a href="/tags/spider/">
                        <span class="chip bg-color">spider</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/posts/hexo_change_theme/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/4.jpg" class="responsive-img" alt="换了一个主题">
                        
                        <span class="card-title">换了一个主题</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            把主题从shana（夏娜）换成了NexT，记录一下这个过程，以及遇到的一些有用的博客链接。流水账，主要保存链接。


缘起刚弄了hexo博客很兴奋，于是去鼓捣各种东西，首先选了一个二次元的主题shana，虽然这个主题我很喜欢，但是想要加目录
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2019-02-28
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E8%BF%87%E7%A8%8B%E5%A4%8D%E7%9B%98/" class="post-category">
                                    过程复盘
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/hexo/">
                        <span class="chip bg-color">hexo</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 憧憬少的个人博客<br />'
            + '文章作者: 憧憬少<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>

    
<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h1, h2, h3, h4, h5, h6'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5, h6').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>



    <footer class="page-footer bg-color">
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            <span id="year">2020</span>
            <a href="https://yxChangingSelf.xyz" target="_blank">憧憬少</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">80.1k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/ChangingSelf" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:ChangingSelf@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=913620659" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 913620659" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fas fa-rss"></i>
    </a>

</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    



    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>


    <!-- Global site tag (gtag.js) - Google Analytics -->


    <!-- Baidu Analytics -->

<script>
    var _hmt = _hmt || [];
    (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?74d1c5bd37e68cef3ecacf9c903ec5a5";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
    })();
</script>

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    
    
    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
